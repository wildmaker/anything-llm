# App Flow Documentation  
## AnythingLLM 企业版 - MVP  

### 概述  
AnythingLLM 企业版 MVP 是一个面向中小企业的智能文档分析工具，通过本地化部署和自然语言交互，帮助用户高效管理和查询文档。本文档描述了应用的页面功能、导航路径和关键交互，基于开源项目 [AnythingLLM](https://github.com/Mintplex-Labs/anything-llm) 的技术架构，并结合 LibreChat 的登录模块和 LobeChat 的聊天界面风格进行了定制。

---

## Description of Every Page  

### 登录页  
- **目的**：验证用户身份，控制应用访问（移植 LibreChat 登录功能）。  
- **关键组件**：  
  - 用户名和密码输入框（LibreChat 风格）。  
  - 登录按钮。  
- **数据需求**：  
  - 用户认证数据（用户名、密码）。  
  - 来源：SQLite 数据库。  
- **用户交互**：  
  - 输入凭据，点击登录跳转到首页（聊天页）。  
- **页面链接**：  
  - 首页（聊天页）。  
- **特殊状态**：  
  - 登录失败时显示错误提示（如“凭据错误”）。  

### 首页（聊天页）  
- **目的**：作为应用主入口，提供与 AI 聊天和知识库管理的核心功能，风格完全照搬 LobeChat。  
- **关键组件**：  
  - **左侧导航栏（两列布局）**：  
    - **最左列（顶级导航）**：切换“聊天”、“知识库”、“设置”的按钮。  
    - **右列（知识库列表）**：展示 Workspace（知识库）卡片列表，每个卡片显示名称和最新会话时间。  
  - **中间区域（聊天主界面，上下布局）**：  
    - **上方（聊天记录）**：继承 AnythingLLM 的气泡式聊天记录窗口，显示用户问题和 AI 回答。  
    - **下方（输入区域）**：LobeChat 风格的输入框，支持发送和多行输入。  
  - **右侧区域（文件列表）**：  
    - 展示当前 Workspace 关联的文件卡片（名称、大小）。  
    - 文件搜索框。  
  - **工具栏（聊天窗口和文件列表上方）**：  
    - 查看历史聊天记录按钮。  
    - 切换 LLM 模型下拉菜单。  
    - 清除聊天记录按钮。  
- **数据需求**：  
  - 用户可访问的 Workspace 列表。  
  - 当前 Workspace 的文档索引和文件元数据。  
  - LLM API 连接和聊天历史。  
  - 来源：SQLite 和 Faiss（向量数据库）。  
- **用户交互**：  
  - 点击左侧知识库卡片，进入最新会话或新建会话。  
  - 在输入框提问，查看聊天记录和引用。  
  - 在右侧搜索文件，点击卡片在新标签页预览文件。  
  - 使用工具栏切换模型或查看历史记录。  
- **页面链接**：  
  - 设置页（顶级导航）。  
  - 知识库页（顶级导航）。  
  - 文件预览页（新标签页）。  
- **特殊状态**：  
  - 无 Workspace 时提示“请创建知识库”。  
  - 无文档时聊天区域显示“请上传文档”。  

### 知识库页  
- **目的**：管理知识库（Workspace），包括创建和上传文档。  
- **关键组件**：  
  - 知识库列表（与首页左侧右列一致）。  
  - “创建新知识库”按钮。  
  - “上传文档”按钮。  
  - 知识库设置（名称、权限）。  
- **数据需求**：  
  - 用户关联的 Workspace 列表及其文档。  
  - 来源：SQLite。  
- **用户交互**：  
  - 点击“创建新知识库”输入名称。  
  - 点击“上传文档”进入上传流程。  
  - 编辑知识库名称或权限。  
- **页面链接**：  
  - 首页（返回聊天页）。  
  - 文档上传页。  
- **特殊状态**：  
  - 无知识库时显示“尚未创建知识库”提示。  

### 文档上传页  
- **目的**：上传文档到指定知识库并生成索引。  
- **关键组件**：  
  - 文件上传区域（支持拖放）。  
  - 已上传文件列表（显示进度）。  
  - “完成”按钮。  
- **数据需求**：  
  - 当前知识库的存储路径。  
  - 上传文件（Excel、PDF、Word、TXT）。  
  - 来源：本地文件系统和 SQLite。  
- **用户交互**：  
  - 拖放或选择文件上传。  
  - 点击“完成”返回知识库页或首页。  
- **页面链接**：  
  - 知识库页或首页（返回）。  
- **特殊状态**：  
  - 上传失败时显示“文件格式不支持”提示。  

### 设置页  
- **目的**：配置 LLM 提供者和用户账户。  
- **关键组件**：  
  - LLM 提供者选择（输入 API 密钥）。  
  - 语言选择（中文/英文）。  
  - 用户账户设置（修改密码）。  
  - “保存”按钮。  
- **数据需求**：  
  - 当前配置数据。  
  - 用户账户信息。  
  - 来源：SQLite。  
- **用户交互**：  
  - 选择 LLM 并输入密钥。  
  - 切换语言。  
  - 更新密码并保存。  
- **页面链接**：  
  - 首页（返回）。  
- **特殊状态**：  
  - 保存成功时显示“设置已更新”。  
  - API 密钥无效时显示“密钥错误”。  

### 用户管理页  
- **目的**：管理员管理用户账户和权限。  
- **关键组件**：  
  - 用户列表（用户名、角色）。  
  - “添加用户”表单。  
  - 编辑/删除用户按钮。  
- **数据需求**：  
  - 用户数据和权限分配。  
  - 来源：SQLite。  
- **用户交互**：  
  - 添加新用户。  
  - 编辑角色或删除用户。  
- **页面链接**：  
  - 首页（返回）。  
- **特殊状态**：  
  - 非管理员访问时显示“无权限”并跳转首页。  

---

## User Navigation Paths  

### 主导航流程  
- **核心使用**：登录页 → 首页（聊天页） → 选择知识库卡片 → 聊天或上传文档。  
- **配置调整**：首页 → 设置页 → 保存 → 返回首页。  
- **知识库管理**：首页 → 知识库页 → 创建/上传 → 返回首页。  

### 入口和出口点  
- **入口**：登录页。  
- **出口**：顶部导航“退出”按钮返回登录页。  

### 常见用户旅程  
1. **快速查询**：登录 → 首页 → 点击知识库卡片 → 输入问题聊天。  
2. **新知识库创建**：登录 → 首页 → 知识库页 → 创建知识库 → 上传文档 → 返回首页聊天。  
3. **管理员操作**：登录 → 首页 → 设置页配置 LLM → 用户管理页添加用户。  

### 替代路径  
- 从首页左侧导航直接切换到设置页或知识库页。  
- 点击右侧文件卡片在新标签页预览，无需离开聊天页。  

### 错误/边缘情况处理  
- **无知识库**：首页左侧提示“请创建知识库”，链接到知识库页。  
- **无文档**：聊天区域显示“请上传文档”，链接到上传页。  
- **LLM 不可用**：提示“服务不可用，请检查设置”，链接到设置页。  

### 前后导航处理  
- 浏览器“后退”/“前进”保持状态（如当前知识库和聊天记录）。  
- 页面间提供“返回”按钮（如从设置页回首页）。  

---

## Specific Interactions (in Simple Language)  

### 如何上传和管理文档  
- **上传**：在知识库页或首页点击“上传文档”，拖放文件或选择文件，完成后返回。  
- **管理**：在知识库页查看文档列表，删除不需要的文件。  

### 如何使用聊天/对话界面  
- 在首页中间输入框写问题（如“销售额多少？”），按回车发送。  
- AI 回答显示在气泡记录区，引用可点击查看来源。  
- 用工具栏切换模型或清除记录，样式模仿 LobeChat。  

### 文档组织和分类  
- 在首页左侧创建新知识库（如“销售数据”），每个知识库包含相关文档。  
- 点击卡片切换知识库，自动加载最新会话。  

### 搜索和过滤功能  
- **文件搜索**：右侧文件列表输入关键词查找文件。  
- **内容查询**：中间聊天区用自然语言提问，AI 自动搜索文档。  

### 设置和配置选项  
- 在设置页选 LLM（如 xAI），输入 API 密钥。  
- 切换语言（中文/英文）。  
- 修改密码后保存。  

### 错误处理和用户反馈  
- **上传失败**：显示“文件不支持”并提供重试选项。  
- **聊天失败**：显示“AI 不可用，请检查设置”。  
- **成功提示**：上传或保存时显示“操作成功”。  

